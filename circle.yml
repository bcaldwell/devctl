## Customize deployment commands
machine:
  environment:
    GODIST: "go1.7.3.linux-amd64.tar.gz"
  post:
    - mkdir -p downloads
    - test -e downloads/$GODIST || curl -o downloads/$GODIST https://storage.googleapis.com/golang/$GODIST
    - sudo rm -rf /usr/local/go
    - sudo tar -C /usr/local -xzf downloads/$GODIST

checkout:
  post:
  - git submodule sync --recursive
  - git submodule update --recursive --init
test:
  override:
    # './...' is a relative pattern which means all subdirectories
    - go test -v -race $(go list ./... | grep -v /vendor/)

deployment:
  release:
    branch: master
    commands:
      - bash scripts/release.sh

  production:
    branch: master
    commands:
      - mkdir -p /home/ubuntu/.go_workspace/src/github.com/benjamincaldwell
      - ln -s /home/ubuntu/devctl /home/ubuntu/.go_workspace/src/github.com/benjamincaldwell/devctl
      - cd /home/ubuntu/devctl && env GOOS=darwin GOARCH=amd64 go build -o devctl.mac
      - cd /home/ubuntu/devctl && env GOOS=linux GOARCH=amd64 go build -o devctl.linux
      - git clone git@github.com:devctl/devctl.git "$HOME/deploy"
      - mv /home/ubuntu/devctl/devctl.* "$HOME/deploy/" 
      - mv /home/ubuntu/devctl/install.sh "$HOME/deploy/" 
      - git config --global user.email "caldwellbenjamin8@gmail.com" 
      - git config --global user.name "benjamin-bot" 
      - cd "$HOME/deploy" && git add . 
      - cd "$HOME/deploy" && git commit -m "Auto update from circleci" 
      - cd "$HOME/deploy" && git push origin master 
